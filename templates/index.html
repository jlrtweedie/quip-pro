<!DOCTYPE html>
<html>
<head>
  <title>Hello World</title>
  <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
</head>
<body>

  <div id="test"></div>
  <p>Average ping/pong latency: <b><span id="ping-pong"></span>ms</b></p>
  <script src="../static/js/test.js" type="text/babel"></script>

  <script type="text/javascript">

    $(document).ready(() => {
      namespace = '/test';

      let socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
      let ping_pong_times = [];
      let start_time;

      window.setInterval(() => {
        start_time = (new Date).getTime();
        socket.emit('my_ping');
      }, 1000);

      socket.on('my_pong', () => {
        let latency = (new Date).getTime() - start_time;
        ping_pong_times.push(latency);
        ping_pong_times = ping_pong_times.slice(-30);
        let sum = 0;
        for (let i = 0; i < ping_pong_times.length; i++) {
          sum += ping_pong_times[i];
        }
        $('#ping-pong').text(Math.round(10 * sum / ping_pong_times.length) / 10);
      });
    });

  </script>

</body>
</html>
